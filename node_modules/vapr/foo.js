'use strict';
const http = require('http');
const app = require('.')();

app.get('/foo', (req) => [['hello']]);

const server = http.createServer(app).listen(9999, () => {
	const client = http.request({ method: 'GET', port: 9999, path: '/foo' });
	client.on('error', (err) => {
		console.log('ERROR:', err);
	});
	client.on('response', (res) => {
		console.log('GOT:', res.statusCode, res.headers);
		const buffers = [];
		res.on('error', (err) => {
			console.log('ERROR:', err);
			server.close();
		});
		res.on('data', (data) => {
			buffers.push(data);
		});
		res.on('end', () => {
			console.log('BODY:\n' + Buffer.concat(buffers).toString());
			server.close();
		});
		res.on('close', () => {
			console.log('CLOSED');
			server.close();
		});
	});
	client.end();
});
