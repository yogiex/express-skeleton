'use strict';
const net = require('net');
const http = require('http');
const app = require('.')();

app.get('/foo', (req) => 204);

const server = http.createServer(app).listen(9999, () => {
	const socket = net.connect(9999);
	socket.on('error', (err) => {
		console.log('ERROR:', err);
	});
	socket.on('connect', () => {
		const buffers = [];
		socket.on('data', (data) => {
			buffers.push(data);
		});
		socket.on('end', () => {
			console.log('BODY:\n' + Buffer.concat(buffers).toString());
			server.close();
		});
		socket.on('close', () => {
			console.log('CLOSED');
			server.close();
		});
		socket.write('GET /foo HTTP/1.1\n\n');
		socket.end();
	});
});
