"use strict";
const constants_1 = require("../constants");
const events = require("../events");
const handle = (error, req, res) => {
    events.emit(`error-${error.code || constants_1.http.INTERNAL_SERVER_ERROR}`, error, req, res);
    // if (process.env.NODE_ENV === "development") console.error("Encapsulation: ", error);
};
class Encapsulation {
    constructor(fn) {
        this._fn = fn;
    }
    run(req, res, ...rest) {
        try {
            const result = this._fn(req, res, ...rest);
            if (result instanceof Promise)
                result.catch((err) => handle(err, req, res));
        }
        catch (err) {
            handle(err, req, res);
        }
    }
}
module.exports = Encapsulation;
